/*! gmailr 0.0.4 - 2014-12-02 */

(function(){var a=[].slice,b=function(a,b){return function(){return a.apply(b,arguments)}};!function(c,d){var e,f,g,h;f=function(){function a(a){var b,d;this.initialized||(this.initialized=!0,b=this,d=top.document.getElementById("js_frame").contentDocument.defaultView,null==this._Gmail_open&&(this._Gmail_open=d.XMLHttpRequest.prototype.open),d.XMLHttpRequest.prototype.open=function(a,c){return this.xhrParams={method:a.toString(),url:c.toString()},b._Gmail_open.apply(this,arguments)},null==this._Gmail_send&&(this._Gmail_send=d.XMLHttpRequest.prototype.send),d.XMLHttpRequest.prototype.send=function(c){return this.xhrParams&&(this.xhrParams.body=c,a(this.xhrParams)),b._Gmail_send.apply(this,arguments)},null==top._Gmail_iframeFn&&(top._Gmail_iframeFn=top.GG_iframeFn),this.iframeCachedData.push({responseDataId:1,url:top.location.href,responseData:top.VIEW_DATA}),top.GG_iframeFn=function(d,e){var f,h,i,j,k,l,m,n;h=top._Gmail_iframeFn.apply(this,arguments);try{l=null!=(m=null!=d&&null!=(n=d.location)?n.href:void 0)?m:null,e&&-1!==(null!=l?l.indexOf("act="):void 0)&&(b.iframeData[l]||(b.iframeData[l]=!0,f="",(j=d.frameElement.parentNode)&&(k=c(j).find("form"),k.length>0&&(f=k.first().serialize())),a({body:f,url:l})))}catch(o){i=o;try{g("DEBUG error in GG_iframeFn: ",i)}catch(o){}}return h})}return a.prototype.initialized=!1,a.prototype.iframeData={},a.prototype.iframeCachedData=[],a.prototype._Gmail_open=null,a.prototype._Gmail_send=null,a}(),g=function(){var b;b=1<=arguments.length?a.call(arguments,0):[],b.unshift("[Gmailr]"),("undefined"!=typeof console&&null!==console?console.log:void 0)&&e.debug===!0&&console.log.apply(console,b)},h=function(a,b){return b.parents().index(a)>=0},e=function(){function d(){this.detectDOMEvents=b(this.detectDOMEvents,this),this.detectXHREvents=b(this.detectXHREvents,this)}return d.prototype.debug=!1,d.prototype.priorityInboxLink=null,d.prototype.inboxLink=null,d.prototype.currentNumUnread=null,d.prototype.currentInboxCount=null,d.prototype.elements={},d.prototype.currentLeftMenuItem=null,d.prototype.observers={},d.prototype.loaded=!1,d.prototype.inConversationView=!1,d.prototype.xhrWatcher=null,d.prototype.delayedLoader=null,d.prototype.ignoreDOMElements=[],d.prototype.EVENT_VIEW_THREAD="viewThread",d.prototype.EVENT_LOADED="load",d.prototype.EVENT_ARCHIVE="archive",d.prototype.EVENT_APPLY_LABEL="applyLabel",d.prototype.EVENT_DELETE="delete",d.prototype.EVENT_COMPOSE="compose",d.prototype.EVENT_REPLY="reply",d.prototype.EVENT_SPAM="spam",d.prototype.EVENT_DRAFT_DISCARD="discardDraft",d.prototype.EVENT_DRAFT_SAVE="saveDraft",d.prototype.EVENT_MARK_UNREAD="unread",d.prototype.EVENT_STAR="star",d.prototype.EVENT_UNSTAR="unstar",d.prototype.EVENT_UNREAD_CHANGE="numUnreadChange",d.prototype.EVENT_INBOX_COUNT_CHANGE="inboxCountChange",d.prototype.EVENT_VIEW_CHANGED="viewChanged",d.prototype.EVENT_REFRESH_INBOX="refresh",d.prototype.EVENT_ANY="any",d.prototype.VIEW_CONVERSATION="conversation",d.prototype.VIEW_THREADED="threaded",d.prototype.init=function(a){var b;return this.loaded?(g("Gmailr has already been initialized"),void("function"==typeof a&&a(this))):(g("Initializing Gmailr API"),b=function(b){return function(){var d;b.elements.canvas=c((d=c("#canvas_frame").get(0))?d.contentDocument:document),b.elements.body=b.elements.canvas.find(".nH").first(),b.loaded?(clearInterval(b.delayedLoader),g("Delayed loader success."),b.elements.body.children().on("DOMSubtreeModified",b.detectDOMEvents),b.notify(b.EVENT_LOADED)):(g("Calling delayed loader..."),b.bootstrap(a))}}(this),void(this.delayedLoader=setInterval(b,200)))},d.prototype.bootstrap=function(a){var b,c;this.inBootstrap||(this.inBootstrap=!0,this.elements.body&&(this.leftMenu&&0!==this.leftMenu.length||((b=this.getInboxLink())?this.leftMenu=b.closest(".TO").closest("div"):(c=this.elements.body.find("a[href$='#mbox']"),c.length>0&&(this.priorityInboxLink=c.first()),this.priorityInboxLink&&(this.leftMenu=this.priorityInboxLink.closest(".TO").closest("div"))),this.leftMenu&&this.leftMenu.length>0&&(this.leftMenuItems=this.leftMenu.find(".TO"),g("Fully loaded."),this.loaded=!0,this.currentNumUnread=this.numUnread(),this.inboxTabHighlighted()&&(this.currentInboxCount=this.toolbarCount()),this.xhrWatcher=new f(this.detectXHREvents),"function"==typeof a&&a(this)))),this.inBootstrap=!1)},d.prototype.intercept=function(){if(!this.loaded)throw"Call to method before Gmail has loaded"},d.prototype.insertTop=function(a,b){null==b&&(b=!0),this.intercept(),a=c(a),this.elements.body.prepend(a),b&&this.ignoreDOMElements.push(a.get(0))},d.prototype.$=function(a){return this.intercept(),this.elements.body.find(a)},d.prototype.observe=function(a,b){var c;return(null!=(c=this.observers)[a]?c[a]:c[a]=[]).push(b)},d.prototype.notify=function(){var b,c,d,e,f,g,h,i,j;if(d=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],this.observers[d])for(i=this.observers[d],e=0,g=i.length;g>e;e++)c=i[e],null!=c&&"function"==typeof c.apply&&c.apply(this,b);if(d!==this.EVENT_ANY&&this.observers[this.EVENT_ANY])for(j=this.observers[this.EVENT_ANY],f=0,h=j.length;h>f;f++)c=j[f],null!=c&&"function"==typeof c.call&&c.call(this,d,b)},d.prototype.numUnread=function(){var a,b;return this.intercept(),b=this.getInboxLink().attr("title"),a=/\((\d+)\)/.exec(b),(null!=a?a[1]:void 0)?parseInt(a[1]):0},d.prototype.emailAddress=function(){var a,b;return this.intercept(),b=["#guser b",".gbmp1",".gbps2"],a=this.elements.canvas.find(b.join(",")),a.first().html()},d.prototype.currentView=function(){return this.intercept(),this.elements.canvas.find("h1.ha").length>0?this.VIEW_CONVERSATION:this.VIEW_THREADED},d.prototype.inboxes=["a[href$='#inbox'][title^='Inbox']","a[href$='#inbox'][title^='Posteingang']","a[href$='#inbox'][title^='Postvak IN']","a[href$='#inbox'][target='_top']"],d.prototype.getInboxLink=function(){return this.elements.body.find(this.inboxes.join(",")).first()||null},d.prototype.liveLeftMenuItem=function(){var a;return this.loaded?(a=this.leftMenuItems.filter(".nZ").find("a"),a[0]?a[0].title:null):null},d.prototype.inboxTabHighlighted=function(){return"inbox"===this.currentTabHighlighted()||"priority_inbox"===this.currentTabHighlighted()},d.prototype.currentTabHighlighted=function(){var a;return a=this.getInboxLink(),a&&a.closest(".TO").hasClass("nZ")?"inbox":this.priorityInboxLink&&this.priorityInboxLink.closest(".TO").hasClass("nZ")?"priority_inbox":null},d.prototype.archiveableState=function(){return this.inboxTabHighlighted()&&this.currentView()===this.VIEW_THREADED||this.currentView()!==this.VIEW_THREADED},d.prototype.mainListingEl=function(){return this.elements.canvas.find(".nH.Cp").first()},d.prototype.mainListingEmpty=function(){return this.mainListingEl().length>0&&this.currentView()===this.VIEW_THREADED?0===this.mainListingEl().find("table tr").length:null},d.prototype.toolbarEl=function(){return this.elements.canvas.find(".A1.D.E").first()},d.prototype.toolbarCount=function(){var a,b,c;return a=this.toolbarEl().find(".Dj"),a[0]?(c=a[0].innerHTML,b=/of <b>(\d+)<\/b>/.exec(c),null!=(null!=b?b[1]:void 0)?parseInt(b[1]):null):this.mainListingEmpty()?0:null},d.prototype.toEmailProps=function(a){var b,c;return{inReplyTo:"undefined"===a.rm?null:a.rm,body:null!=(b=a.body)?b:null,subject:null!=(c=a.subject)?c:null,bcc:this.toEmailArray(a.bcc),to:this.toEmailArray(a.to),from:a.from,isHTML:"1"===a.ishtml,cc:this.toEmailArray(a.cc),fromDraft:"undefined"===a.draft?null:a.draft,_raw:a}},d.prototype.toEmailArray=function(a){var b,c,d;if(!a)return[];for(c=/(?:"([^"]+)")? ?<?(.*?@[^>,]+)>?,? ?/g,d=[];b=c.exec(a);)d.push({name:b[1],email:b[2]});return d},d.prototype.detectXHREvents=function(a){var b,d,e,f,h,i,j,k,l;try{switch(j=c.deparam(a.url),b=null!=(k=j.act)?k:j.view,d=1,h=null,a.body.length>0&&(h=c.deparam(a.body),!h||!h.t||h.t instanceof Array||(h.t=[h.t],d=h.t.length),h.ba&&(d=-1)),b){case"ad":j.th?(g("User views a thred"),this.notify(this.EVENT_VIEW_THREAD,j.th)):this.notify(this.EVENT_REFRESH_INBOX);break;case"rc_^i":("inbox"===(l=j.search)||"query"===l||"cat"===l||"mbox"===l)&&h&&(g("User archived emails."),this.notify(this.EVENT_ARCHIVE,d,h.t));break;case"arl":f=j.acn,this.notify(this.EVENT_APPLY_LABEL,f,d,h.t);break;case"tr":g("User deleted "+d+" emails."),this.notify(this.EVENT_DELETE,d,h.t);break;case"sm":this.currentView()===this.VIEW_CONVERSATION?(g("User replied to an email."),this.notify(this.EVENT_REPLY,this.toEmailProps(h))):(g("User composed an email."),this.notify(this.EVENT_COMPOSE,this.toEmailProps(h)));break;case"sp":g("User spammed "+d+" emails."),this.notify(this.EVENT_SPAM,d,h.t);break;case"dr":g("User discarded? a draft."),this.notify(this.EVENT_DRAFT_DISCARD);break;case"sd":g("User saved? a draft."),this.notify(this.EVENT_DRAFT_SAVE,this.toEmailProps(h));break;case"ur":g("User marked messages as unread."),this.notify(this.EVENT_MARK_UNREAD,d,h.t);break;case"st":g("User starred messages."),i=function(){switch(h.sslbl){case"^ss_sy":return"standard";default:return"unknown"}}(),this.notify(this.EVENT_STAR,d,h.t,i);break;case"xst":g("User unstarred messages."),this.notify(this.EVENT_UNSTAR,d,h.t)}}catch(m){e=m,g("Error in detectXHREvents: "+e)}},d.prototype.detectDOMEvents=function(a){var b,d,e,f,i,j,k;for(a.stopPropagation(),k=this.ignoreDOMElements,i=0,j=k.length;j>i;i++)if(d=k[i],c.contains(d,a.target))return!1;return b=c(a.target),e=this.numUnread(),this.currentNumUnread!==e&&(g("Unread count changed"),this.notify(this.EVENT_UNREAD_CHANGE,e,this.currentNumUnread),this.currentNumUnread=e),this.elements.canvas.find(".ha").length>0?this.inConversationView||(this.inConversationView=!0,this.notify(this.EVENT_VIEW_CHANGED,this.VIEW_CONVERSATION)):this.inConversationView&&(this.inConversationView=!1,this.notify(this.EVENT_VIEW_CHANGED,this.VIEW_THREADED)),h(this.toolbarEl(),b)&&(f=this.toolbarCount(),this.inboxTabHighlighted()&&f&&(null===this.currentInboxCount||f!==this.currentInboxCount))?(null!==this.currentInboxCount&&this.notify(this.EVENT_INBOX_COUNT_CHANGE,f,this.currentInboxCount),this.currentInboxCount=f):void 0},d}(),e=new e,d.Gmailr=e}(jQuery,window)}).call(this);
//# sourceMappingURL=gmailr.min.js.map